<html>
    <head>
        <h1>FPID Demo</h1>
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <script src="https://assets.adobedtm.com/22bf1a13013f/45c48148f3db/launch-3bb83e881f0c-development.min.js" async></script>
        <script type="text/javascript">

            function getUUID() {
                return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
                    );
            }

            function generateUUID() {
                var fpidValue = getUUID();
                if(cbFPID.checked == 1) {
                    document.getElementById("fpidValue").innerHTML = "FPID Value: " + fpidValue;
                } else {
                    document.getElementById("fpidValue").innerHTML = "FPID Value: " + fpidValue;
                    //document.getElementById("fpidValue").innerHTML = "FPID Value: Not enabled yet";
                }
                generateTable();
                setCookie("FPID","value-1");
            }
            window.onload = generateUUID;

            function reload() {
                if(cbFPID.checked == 1) {
                    document.getElementById("iframe").src = "Launch_Demo.html";
                } else {
                    document.getElementById("iframe").src = "PreLaunch_Demo.html";
                }
            }

            function generateTable() {
                
                let table = document.querySelector("table");
                
                // Table Head
                let thead = table.createTHead();
                let row = thead.insertRow();
                let th = document.createElement("th");
                let text = document.createTextNode("Visitor Count");
                th.appendChild(text);
                row.appendChild(th);

                th = document.createElement("th");
                text = document.createTextNode("FPID");
                th.appendChild(text);
                row.appendChild(th);

                th = document.createElement("th");
                text = document.createTextNode("ECID");
                th.appendChild(text);
                row.appendChild(th);

                let tbody = table.createTBody();
                // Table Rows
                for(let i = 0; i < 10; i++) {
                    row = tbody.insertRow();

                    td = document.createElement("td");
                    text = document.createTextNode(i+1);
                    td.appendChild(text);
                    row.appendChild(td);

                    td = document.createElement("td");
                    text = document.createTextNode(getUUID());
                    td.appendChild(text);
                    row.appendChild(td);

                    td = document.createElement("td");
                    text = document.createTextNode(getUUID());
                    td.appendChild(text);
                    row.appendChild(td);
                }
            }

            function getCookie(name) {
                var dc = document.cookie;
                var prefix = name + "=";
                var begin = dc.indexOf("; " + prefix);
                if (begin == -1) {
                    begin = dc.indexOf(prefix);
                    if (begin != 0) return null;
                }
                else
                {
                    begin += 2;
                    var end = document.cookie.indexOf(";", begin);
                    if (end == -1) {
                    end = dc.length;
                    }
                }
                // because unescape has been deprecated, replaced with decodeURI
                //return unescape(dc.substring(begin + prefix.length, end));
                return decodeURI(dc.substring(begin + prefix.length, end));
            } 

            function setCookie(cname, cvalue) {
                
                let d = getTimeStampAfter2Years();
                let expires = "expires="+ d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";domain=example.com;Secure;" + expires;
            }

            function createOrUpdateCookie() {
                var fpidValue = getCookie("FPID");
                if(!!fpidValue) {
                    console.log("FPID Cookie exists with value " + fpidValue);
                } else {
                    fpidValue = getUUID();
                    console.log("FPID Cookie created with value " + fpidValue);
                }
                setCookie("FPID", fpidValue);
            }

            function getTimeStampAfter2Years() {
                var d = new Date();
                var targetDate = new Date(d.getFullYear()+2, d.getMonth(), d.getDate(), d.getHours(), d.getMinutes(), d.getSeconds(), d.getMilliseconds());
                return targetDate;
            }


            window.digitalData = {
                "page": {
                    "pageInfo": {
                        "breadcrumbs": "luma:us:en",
                        "pageShortName": "luma:[...]:en",
                        "pageName": "content:luma:us:en",
                        "destinationURL": "https://luma.enablementadobe.com/content/luma/us/en.html",
                        "isIframe": false,
                        "contentIframe": false,
                        "hierarchiel": "luma:us:en",
                        "title": "Luma: An Adobe demo brand",
                        "internalPageName": "en",
                        "pageID": "luma.enablementadobe.com:content:luma:us:en",
                        "tagging": "",
                        "server": "luma.enablementadobe.com",
                        "urlShortcut": ""
                    },
                    "category": {
                        "type": ":conf:we-retail:settings:wcm:templates:hero-page",
                        "version": "2019-11-21"
                    },
                    "attributes": {},
                    "components": []
                },
                "product": [
                    {
                        "productInfo": {}
                    }
                ],
                "cart": {
                    "productsInCart": 3,
                    "orderId": "cb465f3d-70f4-4c1f-aa0a-52fcb198919a",
                    "cartAmount": "131.00",
                    "cartEntries": [
                        {
                            "qty": "1",
                            "sku": "LLMH12.1-S",
                            "title": "Ajax Full-Zip Sweatshirt (Blue / S)",
                            "formattedPrice": "$69.00",
                            "price": "69.00"
                        },
                        {
                            "qty": "1",
                            "sku": "LLMT09.1-S",
                            "title": "Sinbad Fitness Tank - (Blue / S)",
                            "formattedPrice": "$29.00",
                            "price": "29.00"
                        },
                        {
                            "qty": "1",
                            "sku": "24-WB06",
                            "title": "Endeavor Daytrip Backpack",
                            "formattedPrice": "$33.00",
                            "price": "33.00"
                        }
                    ]
                },
                "user": [
                    {
                        "profile": [
                            {
                                "profileInfo": {},
                                "attributes": {
                                    "loggedIn": false
                                }
                            }
                        ]
                    }
                ],
                "pageInstanceID": "s7connect:nosamplecontent:publish:content:luma:us:en",
                "language": "en"
            };
            window.digitalData.page.pageInfo.referringURL = document.referrer;
            window.digitalData.page.pageInfo.sysEnv = navigator.userAgent;
        </script>
    </head>
    <body>
        <input type="checkbox" id="cbFPID" name="cbFPID" onclick="reload()"><label for="cbFPID">Is FPID Launched?</label><br><br>
        <div id="fpidValue"></div><br>
        ECID Value: <div id="ecidValue"></div><br>

        <div class="float-container">
            <div class="float-child1">
                <iframe src="PreLaunch_Demo.html" id="iframe"  class="iFrameContainer" frameborder="1"></iframe>
                <br>
                <input type="button" id="refreshButton" value="Refresh" onclick="reload()" />
                    </div>
            <div class="float-child2">
                <table class="styled-table"></table>
            </div>
        </div>

<!--        
        <br/>
        
        <div>
            <a href="PreLaunch_Demo.html" target="iframe">Link to Pre-Launch State</a><br />
            <a href="Launch_Demo.html" target="iframe">Link to Launch State</a>
        </div>
        <br><br>
-->
  
        <script>
            //function reload() {
            //    document.getElementById("iframe").src = "PreLaunch_Demo.html";
            //}
            //refreshButton.onclick = reload;
        </script>
    </body>
</html>
